<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>个人资源小站</title>
    
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="libs/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="libs/jquery-confirm/css/jquery-confirm.css">
    <link rel="stylesheet" href="libs/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="css/newCss.css">
    
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        
        .container {
            max-width: 1200px;
            margin-top: 20px;
        }
        
        .post-card {
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,.1);
            transition: transform 0.3s;
        }
        
        .post-card:hover {
            transform: translateY(-5px);
        }
        
        .post-title {
            color: #2c3e50;
            font-weight: bold;
        }
        
        .post-content {
            color: #555;
            line-height: 1.6;
        }
        
        .post-meta {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .admin-panel {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid #dee2e6;
        }
        
        .modal-content {
            border-radius: 10px;
        }
        
        .btn-admin {
            background-color: #3498db;
            color: white;
            border: none;
        }
        
        .btn-admin:hover {
            background-color: #2980b9;
        }
        
        .btn-post {
            background-color: #2ecc71;
            color: white;
            border: none;
        }
        
        .btn-post:hover {
            background-color: #27ae60;
        }
        
        .btn-edit {
            background-color: #f39c12;
            color: white;
            border: none;
        }
        
        .btn-edit:hover {
            background-color: #d68910;
        }
        
        .btn-delete {
            background-color: #e74c3c;
            color: white;
            border: none;
        }
        
        .btn-delete:hover {
            background-color: #c0392b;
        }
        
        .login-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .login-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 10px;
            width: 400px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-control {
            border-radius: 5px;
            border: 1px solid #ddd;
            padding: 10px;
        }
        
        .form-control:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 0.2rem rgba(52,152,219,.25);
        }
        
        .alert {
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
        }
        
        .alert-success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white">
        <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    个人资源小站
                </a>
                
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#">首页</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">资源分类</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">关于</a>
                        </li>
                    </ul>
                    
                    <!-- 右上角管理员登录按钮 -->
                    <button id="adminLoginBtn" class="btn btn-admin">
                        管理员登录
                    </button>
                </div>
        </div>
    </nav>

    <!-- 主要内容区域 -->
    <main class="container">
        <!-- 欢迎区域 -->
        <div class="jumbotron bg-light p-5 rounded mt-4">
            <h1 class="display-4">欢迎来到个人资源小站</h1>
            <p class="lead">这里收集了各种有用的资源、工具和学习资料，方便随时查阅和使用。</p>
            <hr class="my-4">
            <p>您可以浏览下面的资源</p>
        </div>

        <!-- 管理员面板（登录后显示） -->
        <div id="adminPanel" class="admin-panel" style="display: none;">
                <h3>管理员面板</h3>
            <div class="row">
                <div class="col-md-6">
                    <button id="newPostBtn" class="btn btn-post mb-3">
                        新建帖子
                    </button>
                </div>
                <div class="col-md-6 text-end">
                    <button id="logoutBtn" class="btn btn-danger">
                        退出登录
                    </button>
                </div>
            </div>
            
            <!-- 帖子编辑表单 -->
            <div id="postForm" style="display: none;">
                <h4 id="formTitle">新建帖子</h4>
                <form id="editPostForm">
                    <input type="hidden" id="postId" value="">
                    <div class="form-group">
                        <label for="postTitle">标题</label>
                        <input type="text" class="form-control" id="postTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="postContent">内容</label>
                        <textarea class="form-control" id="postContent" rows="5" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="postCategory">分类</label>
                        <select class="form-control" id="postCategory">
                            <option value="学习资料">学习资料</option>
                            <option value="工具推荐">工具推荐</option>
                            <option value="经验分享">经验分享</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="postTags">标签（用逗号分隔）</label>
                        <input type="text" class="form-control" id="postTags" placeholder="例如：JavaScript,编程,教程">
                    </div>
                    <button type="submit" class="btn btn-post">保存</button>
                    <button type="button" id="cancelEditBtn" class="btn btn-secondary">取消</button>
                </form>
            </div>
        </div>

        <!-- 帖子列表 -->
        <div id="postsContainer">
                <h3 class="mb-4">资源帖子</h3>
            <div id="postsList" class="row">
                <!-- 帖子将通过JavaScript动态加载 -->
                <div class="col-12">
                    <div class="alert alert-info">
                        正在加载帖子...
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 登录模态框 -->
    <div id="loginModal" class="login-modal">
        <div class="login-content">
            <span class="close">&times;</span>
                    <h3>管理员登录</h3>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">管理员名称</label>
                    <input type="text" class="form-control" id="username" placeholder="请输入管理员名称" required>
                </div>
                <div class="form-group">
                    <label for="password">密码</label>
                    <input type="password" class="form-control" id="password" placeholder="请输入密码" required>
                </div>
                <div id="loginMessage" class="alert" style="display: none;"></div>
                <button type="submit" class="btn btn-admin btn-block">
                        登录
                </button>
            </form>
        </div>
    </div>

    <!-- JavaScript 库 -->
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="libs/jquery-confirm/js/jquery-confirm.js"></script>
    
    <!-- 自定义脚本 -->
    <script>
        $(document).ready(function() {
            // 初始化帖子数据
            initPosts();
            
            // 登录模态框控制
            const loginModal = $('#loginModal');
            const adminLoginBtn = $('#adminLoginBtn');
            const closeBtn = $('.close');
            const loginForm = $('#loginForm');
            const loginMessage = $('#loginMessage');
            const adminPanel = $('#adminPanel');
            const newPostBtn = $('#newPostBtn');
            const logoutBtn = $('#logoutBtn');
            const postForm = $('#postForm');
            const editPostForm = $('#editPostForm');
            const cancelEditBtn = $('#cancelEditBtn');
            const formTitle = $('#formTitle');
            
            // 打开登录模态框
            adminLoginBtn.click(function() {
                loginModal.show();
                $('#username').focus();
            });
            
            // 关闭登录模态框
            closeBtn.click(function() {
                loginModal.hide();
                clearLoginForm();
            });
            
            // 点击模态框外部关闭
            $(window).click(function(event) {
                if (event.target == loginModal[0]) {
                    loginModal.hide();
                    clearLoginForm();
                }
            });
            
            // 登录表单提交
            loginForm.submit(function(e) {
                e.preventDefault();
                const username = $('#username').val().trim();
                const password = $('#password').val().trim();
                
                // 验证管理员凭据
                if (username === 'wyf666' && password === '9178') {
                    // 登录成功
                    localStorage.setItem('adminLoggedIn', 'true');
                    loginModal.hide();
                    clearLoginForm();
                    showAdminPanel();
                    showMessage('登录成功！', 'success');
                } else {
                    // 登录失败
                    showLoginMessage('管理员名称或密码错误！', 'danger');
                }
            });
            
            // 检查是否已登录
            if (localStorage.getItem('adminLoggedIn') === 'true') {
                showAdminPanel();
            }
            
            // 新建帖子按钮
            newPostBtn.click(function() {
                formTitle.text('新建帖子');
                $('#postId').val('');
                $('#postTitle').val('');
                $('#postContent').val('');
                $('#postCategory').val('学习资料');
                $('#postTags').val('');
                postForm.show();
            });
            
            // 取消编辑
            cancelEditBtn.click(function() {
                postForm.hide();
            });
            
            // 帖子表单提交
            editPostForm.submit(function(e) {
                e.preventDefault();
                
                const postId = $('#postId').val();
                const title = $('#postTitle').val().trim();
                const content = $('#postContent').val().trim();
                const category = $('#postCategory').val();
                const tags = $('#postTags').val().trim();
                
                if (!title || !content) {
                    showMessage('标题和内容不能为空！', 'danger');
                    return;
                }
                
                let posts = JSON.parse(localStorage.getItem('posts') || '[]');
                const now = new Date().toLocaleString('zh-CN');
                
                if (postId) {
                    // 编辑现有帖子
                    const index = posts.findIndex(p => p.id === postId);
                    if (index !== -1) {
                        posts[index] = {
                            ...posts[index],
                            title,
                            content,
                            category,
                            tags: tags ? tags.split(',').map(tag => tag.trim()) : [],
                            updatedAt: now
                        };
                    }
                } else {
                    // 创建新帖子
                    const newPost = {
                        id: 'post_' + Date.now(),
                        title,
                        content,
                        category,
                        tags: tags ? tags.split(',').map(tag => tag.trim()) : [],
                        createdAt: now,
                        updatedAt: now
                    };
                    posts.unshift(newPost);
                }
                
                localStorage.setItem('posts', JSON.stringify(posts));
                postForm.hide();
                loadPosts();
                showMessage(postId ? '帖子更新成功！' : '帖子创建成功！', 'success');
            });
            
            // 退出登录
            logoutBtn.click(function() {
                localStorage.removeItem('adminLoggedIn');
                adminPanel.hide();
                showMessage('已退出登录', 'info');
            });
            
            // 初始化帖子数据
            function initPosts() {
                // 如果没有帖子数据，创建一些示例帖子
                if (!localStorage.getItem('posts')) {
                    const samplePosts = [
                        {
                            id: 'post_1',
                            title: 'JavaScript 学习资源推荐',
                            content: '这里收集了一些优秀的 JavaScript 学习资源：\n1. MDN 文档：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript\n2. freeCodeCamp：https://www.freecodecamp.org/\n3. JavaScript.info：https://javascript.info/\n4. W3Schools：https://www.w3schools.com/js/',
                            category: '学习资料',
                            tags: ['JavaScript', '编程', '教程'],
                            createdAt: '2024-01-01 10:00:00',
                            updatedAt: '2024-01-01 10:00:00'
                        },
                        {
                            id: 'post_2',
                            title: '实用的开发工具推荐',
                            content: '推荐一些提高开发效率的工具：\n- VS Code：https://code.visualstudio.com/\n- Git：https://git-scm.com/\n- Postman：https://www.postman.com/\n- Figma：https://www.figma.com/\n- Chrome DevTools：https://developer.chrome.com/docs/devtools/',
                            category: '工具推荐',
                            tags: ['工具', '开发', '效率'],
                            createdAt: '2024-01-02 14:30:00',
                            updatedAt: '2024-01-02 14:30:00'
                        },
                        {
                            id: 'post_3',
                            title: '前端开发学习路线',
                            content: '分享一个完整的前端开发学习路线：\n1. HTML/CSS 基础：https://developer.mozilla.org/zh-CN/docs/Learn/HTML\n2. JavaScript 核心：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript\n3. 框架学习（React/Vue）：https://reactjs.org/ 或 https://vuejs.org/\n4. 工程化实践：https://webpack.js.org/',
                            category: '经验分享',
                            tags: ['前端', '学习路线', '职业发展'],
                            createdAt: '2024-01-03 09:15:00',
                            updatedAt: '2024-01-03 09:15:00'
                        }
                    ];
                    localStorage.setItem('posts', JSON.stringify(samplePosts));
                }
                
                loadPosts();
            }
            
            // 加载帖子
            function loadPosts() {
                const posts = JSON.parse(localStorage.getItem('posts') || '[]');
                const postsList = $('#postsList');
                
                if (posts.length === 0) {
                    postsList.html(`
                        <div class="col-12">
                            <div class="alert alert-warning">
                                暂无帖子，管理员可以登录后创建新帖子。
                            </div>
                        </div>
                    `);
                    return;
                }
                
                let html = '';
                posts.forEach(post => {
                    const tagsHtml = post.tags.map(tag => 
                        `<span class="badge bg-secondary me-1">${tag}</span>`
                    ).join('');
                    
                    // 处理内容中的链接
                    let processedContent = post.content.substring(0, 100);
                    if (post.content.length > 100) {
                        processedContent += '...';
                    }
                    // 将URL转换为链接
                    processedContent = processedContent.replace(
                        /(https?:\/\/[^\s]+)/g, 
                        '<a href="$1" target="_blank" rel="noopener noreferrer" class="text-primary">$1</a>'
                    );
                    
                    html += `
                        <div class="col-md-6 col-lg-4">
                            <div class="card post-card">
                                <div class="card-body">
                                    <a href="post_detail.html?post_id=${post.id}" class="text-decoration-none text-dark">
                                        <h5 class="card-title post-title">${post.title}</h5>
                                        <div class="mb-2">
                                            <span class="badge bg-primary">${post.category}</span>
                                            ${tagsHtml}
                                        </div>
                                        <div class="card-text post-content">${processedContent}</div>
                                        <div class="post-meta">
                                            <small>创建时间: ${post.createdAt}</small>
                                        </div>
                                    </a>
                                    ${localStorage.getItem('adminLoggedIn') === 'true' ? `
                                        <div class="mt-3">
                                            <button class="btn btn-sm btn-edit edit-post" data-id="${post.id}">
                                                编辑
                                            </button>
                                            <button class="btn btn-sm btn-delete delete-post" data-id="${post.id}">
                                                删除
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                postsList.html(html);
                
                // 绑定编辑和删除事件
                $('.edit-post').click(function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const postId = $(this).data('id');
                    editPost(postId);
                });
                
                $('.delete-post').click(function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const postId = $(this).data('id');
                    deletePost(postId);
                });
                
                // 为帖子卡片添加悬停效果
                $('.post-card').hover(
                    function() {
                        $(this).css('cursor', 'pointer');
                        $(this).find('a').css('text-decoration', 'none');
                    },
                    function() {
                        $(this).find('a').css('text-decoration', 'none');
                    }
                );
            }
            
            // 编辑帖子
            function editPost(postId) {
                const posts = JSON.parse(localStorage.getItem('posts') || '[]');
                const post = posts.find(p => p.id === postId);
                
                if (post) {
                    formTitle.text('编辑帖子');
                    $('#postId').val(post.id);
                    $('#postTitle').val(post.title);
                    $('#postContent').val(post.content);
                    $('#postCategory').val(post.category);
                    $('#postTags').val(post.tags.join(', '));
                    postForm.show();
                }
            }
            
            // 删除帖子
            function deletePost(postId) {
                $.confirm({
                    title: '确认删除',
                    content: '确定要删除这个帖子吗？此操作不可恢复。',
                    type: 'red',
                    buttons: {
                        确认: {
                            btnClass: 'btn-red',
                            action: function() {
                                let posts = JSON.parse(localStorage.getItem('posts') || '[]');
                                posts = posts.filter(p => p.id !== postId);
                                localStorage.setItem('posts', JSON.stringify(posts));
                                loadPosts();
                                showMessage('帖子删除成功！', 'success');
                            }
                        },
                        取消: function() {}
                    }
                });
            }
            
            // 显示管理员面板
            function showAdminPanel() {
                adminPanel.show();
                loadPosts();
            }
            
            // 显示登录消息
            function showLoginMessage(message, type) {
                loginMessage.removeClass('alert-success alert-danger alert-info alert-warning')
                           .addClass('alert-' + type)
                           .text(message)
                           .show();
            }
            
            // 显示消息
            function showMessage(message, type) {
                $.alert({
                    title: type === 'success' ? '成功' : 
                           type === 'danger' ? '错误' : 
                           type === 'warning' ? '警告' : '信息',
                    content: message,
                    type: type,
                    buttons: {
                        确定: function() {}
                    }
                });
            }
            
            // 清空登录表单
            function clearLoginForm() {
                $('#username').val('');
                $('#password').val('');
                loginMessage.hide();
            }
        });
    </script>
</body>
</html>
